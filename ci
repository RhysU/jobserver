#!/bin/bash -eu
# Run uv-based continuous integration tests for jobserver/

# Unit testing runs the tests inside jobserver/test.py
uv run -m unittest -v jobserver.test

# Run examples to verify they work
PYTHONPATH=. uv run examples/ex1_basic.py
PYTHONPATH=. uv run examples/ex2_callbacks.py
PYTHONPATH=. uv run examples/ex3_nested.py
PYTHONPATH=. uv run examples/ex4_nonblocking.py
PYTHONPATH=. uv run examples/ex5_errors.py
PYTHONPATH=. uv run examples/ex6_gating.py
PYTHONPATH=. uv run examples/ex7_environ.py

# PEP8 linting
uvx --from flake8 flake8 jobserver/

# Typehint linting requires a new-enough mypy
uvx --from "mypy>0.770" mypy jobserver/

# Finally, check for formatting issues
uvx --from "black<25" black --check --line-length 79 jobserver/
